"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[96897],{69783:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>a,default:()=>u,frontMatter:()=>s,metadata:()=>l,toc:()=>c});var i=t(24246),r=t(71670),o=t(88109);const s={slug:"moon-v1.7",title:"moon v1.7 - Next-generation configuration and errors",authors:["milesj"],tags:["config","errors"],image:"./img/moon/v1.7.png"},a=void 0,l={permalink:"/blog/moon-v1.7",editUrl:"https://github.com/moonrepo/moon/tree/master/website/blog/2023-05-30_moon-v1.7.mdx",source:"@site/blog/2023-05-30_moon-v1.7.mdx",title:"moon v1.7 - Next-generation configuration and errors",description:"With this release, we've rewritten configuration from the ground up, improved error messages, and",date:"2023-05-30T00:00:00.000Z",tags:[{inline:!0,label:"config",permalink:"/blog/tags/config"},{inline:!0,label:"errors",permalink:"/blog/tags/errors"}],readingTime:2.43,hasTruncateMarker:!0,authors:[{name:"Miles Johnson",title:"Founder, developer",url:"https://github.com/milesj",imageURL:"/img/authors/miles.jpg",key:"milesj"}],frontMatter:{slug:"moon-v1.7",title:"moon v1.7 - Next-generation configuration and errors",authors:["milesj"],tags:["config","errors"],image:"./img/moon/v1.7.png"},unlisted:!1,prevItem:{title:"moon v1.8 - Code owners and shared configuration",permalink:"/blog/moon-v1.8"},nextItem:{title:"proto v0.9 - New GitHub action, plugin unpacking, and more",permalink:"/blog/proto-v0.9"}},d={image:t(35750).Z,authorsImageUrls:[void 0]},c=[{value:"Configuration rewrite",id:"configuration-rewrite",level:2},{value:"Strict parsing",id:"strict-parsing",level:3},{value:"Recursive validation",id:"recursive-validation",level:3},{value:"What&#39;s next?",id:"whats-next",level:3},{value:"Better errors",id:"better-errors",level:2},{value:"Other changes",id:"other-changes",level:2}];function h(e){const n={a:"a",blockquote:"blockquote",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",p:"p",ul:"ul",...(0,r.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"With this release, we've rewritten configuration from the ground up, improved error messages, and\nstarted work on diagnostics!"}),"\n",(0,i.jsx)(n.h2,{id:"configuration-rewrite",children:"Configuration rewrite"}),"\n",(0,i.jsx)(n.p,{children:"If you've ever written Rust before, you may be familiar with the state of configuration crates in\nthe ecosystem. There's only 2 viable choices to choose from, and we've been using 1 of them.\nHowever, it's been a constant source of friction for our use cases, and didn't support features that\nwe've needed (built-in validation, file extending, and more)."}),"\n",(0,i.jsxs)(n.p,{children:["After researching our options, and attempting to contribute upstream, we decided to build our own\nconfiguration solution, unique to moonrepo's projects. As such, we're excited to announce\n",(0,i.jsx)(n.a,{href:"https://github.com/moonrepo/schematic",children:"schematic"}),", the most powerful configuration crate in the\nRust ecosystem, with built-in features like:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Strict parsing with serde (serilization, deserialization)."}),"\n",(0,i.jsx)(n.li,{children:"Code frames in errors (when applicable)."}),"\n",(0,i.jsx)(n.li,{children:"Source file/URL extending."}),"\n",(0,i.jsx)(n.li,{children:"Partial file parsing and merging."}),"\n",(0,i.jsx)(n.li,{children:"Field-level merge strategies."}),"\n",(0,i.jsx)(n.li,{children:"Recursive validation."}),"\n",(0,i.jsx)(n.li,{children:"Dynamic default and env var values."}),"\n",(0,i.jsx)(n.li,{children:"And much more!"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"We've spent the last few weeks building this crate from the ground up, and migrating the moon\ncodebase to it. It's been quite a feat, but we're very excited for what it has to offer already, and\nwhat's to come!"}),"\n",(0,i.jsx)(n.h3,{id:"strict-parsing",children:"Strict parsing"}),"\n",(0,i.jsx)(n.p,{children:"When we fail to parse a configuration file, we now include a descriptive message of the failure, and\nthe file that failed to parse. Typically this will be for unknown fields and invalid value types."}),"\n",(0,i.jsx)(o.Z,{src:t(35319),width:"90%"}),"\n",(0,i.jsx)(o.Z,{src:t(21905),width:"90%"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"We hope this bubbles up typos and incorrectly nested settings!"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"recursive-validation",children:"Recursive validation"}),"\n",(0,i.jsxs)(n.p,{children:["Previously when validation would fail, we'd return on the first error and ignore subsequent errors.\nThis is a non-ideal experience as you'd have to constantly run ",(0,i.jsx)(n.code,{children:"moon"})," commands until all validation\nissues have been resolved."]}),"\n",(0,i.jsx)(n.p,{children:"Now we aggregate all validation errors, even from deeply nested fields, and present them together."}),"\n",(0,i.jsx)(o.Z,{src:t(704),width:"90%"}),"\n",(0,i.jsx)(n.h3,{id:"whats-next",children:"What's next?"}),"\n",(0,i.jsxs)(n.p,{children:["Since ",(0,i.jsx)(n.a,{href:"https://github.com/moonrepo/schematic",children:"schematic"})," is very young, and it hasn't been tested\nheavily in the ecosystem, we expect bugs and weird edge cases to popup. If you encounter any issues,\nplease report them immediately so that we can fix them as soon as possible!"]}),"\n",(0,i.jsx)(n.p,{children:"With that being said, we'll continue to improve parsing, error messages, and unique functionality,\nlike code frames within errors. Here's an example for a basic JSON file."}),"\n",(0,i.jsx)(o.Z,{src:t(44221),width:"90%"}),"\n",(0,i.jsx)(n.h2,{id:"better-errors",children:"Better errors"}),"\n",(0,i.jsxs)(n.p,{children:["You may have noticed the errors in the screenshots above look quite different than what we've\nrendered until now, and you are correct. Going forward, all errors will be rendered by the wonderful\nRust crate, ",(0,i.jsx)(n.a,{href:"https://crates.io/crates/miette",children:"miette"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["We've introduced this crate to handle ",(0,i.jsx)(n.em,{children:"all"})," errors and diagnostics within moon, not just\nconfiguration. So expect a much better developer experience moving forward!"]}),"\n",(0,i.jsx)(o.Z,{src:t(29426),width:"90%"}),"\n",(0,i.jsx)(n.h2,{id:"other-changes",children:"Other changes"}),"\n",(0,i.jsxs)(n.p,{children:["View the ",(0,i.jsx)(n.a,{href:"https://github.com/moonrepo/moon/releases/tag/v1.7.0",children:"official release"})," for a full list of\nchanges."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Added support for npm lockfile v3 format."}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},88109:(e,n,t)=>{t.d(n,{Z:()=>r});var i=t(24246);function r(e){let{src:n,width:t="90%",alt:r="",title:o,align:s="center",padding:a="1rem"}=e;return(0,i.jsx)("div",{style:{marginBottom:a,marginTop:a,textAlign:s},children:(0,i.jsx)("img",{src:n.default,width:t,alt:r,title:o,className:"inline-block"})})}},35750:(e,n,t)=>{t.d(n,{Z:()=>i});const i=t.p+"assets/images/v1.7-1356b391b5588236312e2f059de16e2a.png"},44221:(e,n,t)=>{t.r(n),t.d(n,{default:()=>i});const i=t.p+"assets/images/code-frame-d3a7c89957fbda329862d5703004a54a.png"},29426:(e,n,t)=>{t.r(n),t.d(n,{default:()=>i});const i=t.p+"assets/images/errors-f298dbbf1f59c29318216a22e8464fac.png"},21905:(e,n,t)=>{t.r(n),t.d(n,{default:()=>i});const i=t.p+"assets/images/parse-type-2388b085fbfbf10a8f6dd0f74a2fb863.png"},35319:(e,n,t)=>{t.r(n),t.d(n,{default:()=>i});const i=t.p+"assets/images/parse-unknown-2435995564068e43b3a8d5b52f1ddfaa.png"},704:(e,n,t)=>{t.r(n),t.d(n,{default:()=>i});const i=t.p+"assets/images/validate-c6d158c2f0d9ff9919b13b52e58321ea.png"},71670:(e,n,t)=>{t.d(n,{Z:()=>a,a:()=>s});var i=t(27378);const r={},o=i.createContext(r);function s(e){const n=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);