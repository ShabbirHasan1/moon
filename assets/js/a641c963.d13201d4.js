"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[73931],{12837:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>p,frontMatter:()=>r,metadata:()=>d,toc:()=>a});var t=o(24246),i=o(71670),s=o(27915);const r={title:"Version detection",toc_max_heading_level:6},l=void 0,d={id:"proto/detection",title:"Version detection",description:"The most powerful feature in proto is its contextual version detection, that is triggered with",source:"@site/docs/proto/detection.mdx",sourceDirName:"proto",slug:"/proto/detection",permalink:"/docs/proto/detection",draft:!1,unlisted:!1,editUrl:"https://github.com/moonrepo/moon/tree/master/website/docs/proto/detection.mdx",tags:[],version:"current",frontMatter:{title:"Version detection",toc_max_heading_level:6},sidebar:"proto",previous:{title:"Tool specification",permalink:"/docs/proto/tool-spec"},next:{title:"Supported tools",permalink:"/docs/proto/tools"}},c={},a=[{value:"1. Version is explicitly passed as a command line argument",id:"1-version-is-explicitly-passed-as-a-command-line-argument",level:4},{value:"2. Version is provided with the <code>PROTO_*_VERSION</code> environment variable",id:"2-version-is-provided-with-the-proto__version-environment-variable",level:4},{value:"3. Version is located by traversing the file system",id:"3-version-is-located-by-traversing-the-file-system",level:4},{value:"3.1. Version is defined locally in <code>.prototools</code>",id:"31-version-is-defined-locally-in-prototools",level:5},{value:"3.2. Version is defined in the tool&#39;s ecosystem",id:"32-version-is-defined-in-the-tools-ecosystem",level:5},{value:"4. Version is defined globally",id:"4-version-is-defined-globally",level:4},{value:"5. Version <em>could not</em> be detected",id:"5-version-could-not-be-detected",level:4}];function h(e){const n={a:"a",code:"code",em:"em",h4:"h4",h5:"h5",p:"p",pre:"pre",...(0,i.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.Z,{text:"2 min"}),"\n",(0,t.jsxs)(n.p,{children:["The most powerful feature in proto is its contextual version detection, that is triggered with\n",(0,t.jsx)(n.a,{href:"./commands/run",children:(0,t.jsx)(n.code,{children:"proto run"})}),", ",(0,t.jsx)(n.a,{href:"./commands/bin",children:(0,t.jsx)(n.code,{children:"proto bin"})}),", or when a shim is executed. So what\ndoes this mean exactly? Before a tool in proto's toolchain can be executed, we need to determine the\nversion of the tool to execute with. If a detected version exists locally, we proceed using that\nbinary, otherwise we fail with a missing installation error."]}),"\n",(0,t.jsx)(n.p,{children:"When detecting a version, the following steps are checked, in the order as listed:"}),"\n",(0,t.jsx)(n.h4,{id:"1-version-is-explicitly-passed-as-a-command-line-argument",children:"1. Version is explicitly passed as a command line argument"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"$ proto run node 18.0.0\n"})}),"\n",(0,t.jsxs)(n.h4,{id:"2-version-is-provided-with-the-proto__version-environment-variable",children:["2. Version is provided with the ",(0,t.jsx)(n.code,{children:"PROTO_*_VERSION"})," environment variable"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"$ PROTO_NODE_VERSION=18.0.0 proto run node\n"})}),"\n",(0,t.jsx)(n.h4,{id:"3-version-is-located-by-traversing-the-file-system",children:"3. Version is located by traversing the file system"}),"\n",(0,t.jsx)(n.p,{children:"This step will attempt to find a configuration or manifest file in the current working directory,\nand traverse upwards through parent directories (stops at the user's home directory) until a file is\nfound."}),"\n",(0,t.jsxs)(n.h5,{id:"31-version-is-defined-locally-in-prototools",children:["3.1. Version is defined locally in ",(0,t.jsx)(n.code,{children:".prototools"})]}),"\n",(0,t.jsxs)(n.p,{children:["A ",(0,t.jsx)(n.code,{children:".prototools"}),' file was found and a version entry exists for the current tool. This is also known\nas a "local version" and can be created with ',(0,t.jsx)(n.a,{href:"./commands/pin",children:(0,t.jsx)(n.code,{children:"proto pin"})}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-toml",metastring:'title=".prototools"',children:'node = "18.0.0"\n'})}),"\n",(0,t.jsx)(n.h5,{id:"32-version-is-defined-in-the-tools-ecosystem",children:"3.2. Version is defined in the tool's ecosystem"}),"\n",(0,t.jsxs)(n.p,{children:["Depending on the tool, a version is extracted from a found file unique to that tool's ecosystem.\nThis includes version manager configs (",(0,t.jsx)(n.code,{children:".nvmrc"}),", etc), manifest files (",(0,t.jsx)(n.code,{children:"package.json"}),", etc), and\nmore."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",metastring:'title=".nvmrc"',children:"18.0.0\n"})}),"\n",(0,t.jsx)(n.h4,{id:"4-version-is-defined-globally",children:"4. Version is defined globally"}),"\n",(0,t.jsxs)(n.p,{children:['As the last check, we look for a "global version" that was pinned with\n',(0,t.jsx)(n.a,{href:"./commands/pin",children:(0,t.jsx)(n.code,{children:"proto pin --global"})})," or ",(0,t.jsx)(n.a,{href:"./commands/install",children:(0,t.jsx)(n.code,{children:"proto install --pin"})}),". This version\nis stored at ",(0,t.jsx)(n.code,{children:"~/.proto/.prototools"}),"."]}),"\n",(0,t.jsxs)(n.h4,{id:"5-version-could-not-be-detected",children:["5. Version ",(0,t.jsx)(n.em,{children:"could not"})," be detected"]}),"\n",(0,t.jsx)(n.p,{children:"If all the previous steps have failed, then we could not detect an applicable version, and the\nprocess will fail."})]})}function p(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},27915:(e,n,o)=>{o.d(n,{Z:()=>s});var t=o(9619),i=o(24246);function s(e){let{text:n}=e;return(0,i.jsx)(t.Z,{text:n,icon:"material-symbols:clock-loader-40",variant:"success",className:"absolute right-0 top-1.5"})}},9619:(e,n,o)=>{o.d(n,{Z:()=>l});var t=o(40624),i=o(75686),s=o(24246);const r={failure:"bg-red-100 text-red-900",info:"bg-pink-100 text-pink-900",success:"bg-green-100 text-green-900",warning:"bg-orange-100 text-orange-900"};function l(e){let{className:n,icon:o,text:l,variant:d}=e;return(0,s.jsxs)("span",{className:(0,t.Z)("inline-flex items-center px-1 py-0.5 rounded text-xs font-bold uppercase",d?r[d]:"bg-gray-100 text-gray-800",n),children:[o&&(0,s.jsx)(i.Z,{icon:o,className:"mr-1"}),l]})}},71670:(e,n,o)=>{o.d(n,{Z:()=>l,a:()=>r});var t=o(27378);const i={},s=t.createContext(i);function r(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);