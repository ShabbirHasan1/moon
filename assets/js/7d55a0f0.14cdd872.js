"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[46920],{19746:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>s,metadata:()=>l,toc:()=>d});var o=t(24246),a=t(71670),i=(t(33337),t(39798),t(76911),t(88109));const s={slug:"v0.25",title:"moon v0.25 - Deno tier 2 support, CI insights, custom project languages, and more",authors:["milesj"],tags:["deno","toolchain","moonbase","offline","github"],image:"./img/v0.25.png"},r=void 0,l={permalink:"/blog/v0.25",editUrl:"https://github.com/moonrepo/moon/tree/master/website/blog/2023-02-27_v0.25.mdx",source:"@site/blog/2023-02-27_v0.25.mdx",title:"moon v0.25 - Deno tier 2 support, CI insights, custom project languages, and more",description:"With this release, we're landing Deno, our first supported language besides Node.js, and improving",date:"2023-02-27T00:00:00.000Z",tags:[{inline:!0,label:"deno",permalink:"/blog/tags/deno"},{inline:!0,label:"toolchain",permalink:"/blog/tags/toolchain"},{inline:!0,label:"moonbase",permalink:"/blog/tags/moonbase"},{inline:!0,label:"offline",permalink:"/blog/tags/offline"},{inline:!0,label:"github",permalink:"/blog/tags/github"}],readingTime:4.475,hasTruncateMarker:!0,authors:[{name:"Miles Johnson",title:"Founder, developer",url:"https://github.com/milesj",imageURL:"/img/authors/miles.jpg",key:"milesj"}],frontMatter:{slug:"v0.25",title:"moon v0.25 - Deno tier 2 support, CI insights, custom project languages, and more",authors:["milesj"],tags:["deno","toolchain","moonbase","offline","github"],image:"./img/v0.25.png"},unlisted:!1,prevItem:{title:"Introducing proto, a next-generation toolchain manager!",permalink:"/blog/proto"},nextItem:{title:"moon v0.24 - Remote caching, interactive tasks, query improvements, and more",permalink:"/blog/v0.24"}},c={image:t(6995).Z,authorsImageUrls:[void 0]},d=[{value:"Deno tier 2 support (experimental)",id:"deno-tier-2-support-experimental",level:2},{value:"CI insights in moonbase",id:"ci-insights-in-moonbase",level:2},{value:"Offline mode",id:"offline-mode",level:2},{value:"Custom project <code>language</code>",id:"custom-project-language",level:2},{value:"Project-level TypeScript settings (breaking)",id:"project-level-typescript-settings-breaking",level:2},{value:"New <code>moonrepo/setup-moon-action</code> GitHub action",id:"new-moonreposetup-moon-action-github-action",level:2},{value:"Other changes",id:"other-changes",level:2},{value:"What&#39;s next?",id:"whats-next",level:2}];function u(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.a)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.p,{children:"With this release, we're landing Deno, our first supported language besides Node.js, and improving\ninteroperability of languages as a whole."}),"\n",(0,o.jsx)(n.h2,{id:"deno-tier-2-support-experimental",children:"Deno tier 2 support (experimental)"}),"\n",(0,o.jsxs)(n.p,{children:["Three months ago we announced our ",(0,o.jsx)(n.a,{href:"./v0.21",children:"new tiered support structure"})," for languages, and as of\ntoday, we're happy to announce that our second language to reach tier 2 is\n",(0,o.jsx)(n.a,{href:"https://deno.land",children:"Deno"}),"! With tier 2 support, we now analyze Deno specific configuration files\n(like ",(0,o.jsx)(n.code,{children:"deno.json"}),") to infer dependencies and relationships, as well as utilize this information for\ninputs and hashing purposes. With that being said, we're marking this release as experimental until\nwe fine tune the implementation, and iron out all the bugs."]}),"\n",(0,o.jsxs)(n.p,{children:["To get started with using Deno, enable the new ",(0,o.jsx)(n.a,{href:"/docs/config/toolchain#deno",children:(0,o.jsx)(n.code,{children:"deno"})})," setting in\n",(0,o.jsx)(n.a,{href:"/docs/config/toolchain",children:(0,o.jsx)(n.code,{children:".moon/toolchain.yml"})}),". At this time, we don't have many settings to\nconfigure, so simply defining an empty object is enough to enable the Deno platform! Learn more\nabout this in our ",(0,o.jsx)(n.a,{href:"/docs/guides/javascript/deno-handbook",children:"Deno handbook"}),"."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",metastring:'title=".moon/toolchain.yml"',children:"deno: {}\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Once enabled, you can start using ",(0,o.jsx)(n.code,{children:"deno"})," commands in your moon tasks. moon will automatically set\nthe ",(0,o.jsx)(n.a,{href:"/docs/config/project#platform-1",children:(0,o.jsx)(n.code,{children:"platform"})}),' to "deno" when using a deno command.']}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",metastring:'title="moon.yml"',children:"tasks:\n  format:\n    command: 'deno fmt'\n"})}),"\n",(0,o.jsx)(n.admonition,{type:"info",children:(0,o.jsxs)(n.p,{children:["Because this is only tier 2 support, moon ",(0,o.jsx)(n.em,{children:"does not"})," download and install Deno into its toolchain.\nmoon expects the ",(0,o.jsx)(n.code,{children:"deno"})," binary to exist in the current environment."]})}),"\n",(0,o.jsxs)(n.p,{children:["Furthermore, if you're working a project that is composed of multiple JavaScript runtimes, like\nDeno, Bun, or Node.js, you can set the default ",(0,o.jsx)(n.code,{children:"platform"})," for all tasks at the project-level."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",metastring:'title="moon.yml"',children:"platform: 'deno'\nlanguage: 'typescript'\ntype: 'application'\n"})}),"\n",(0,o.jsx)(n.p,{children:"We're very excited for this release as it paves the way for future language integrations, and\nenables additional JavaScript runtimes!"}),"\n",(0,o.jsx)(n.h2,{id:"ci-insights-in-moonbase",children:"CI insights in moonbase"}),"\n",(0,o.jsxs)(n.p,{children:["We've spent the last few weeks implementing a new ",(0,o.jsx)(n.a,{href:"https://moonrepo.app",children:"moonbase"})," feature called CI\ninsights, where we track all CI runs (via ",(0,o.jsx)(n.a,{href:"/docs/commands/ci",children:(0,o.jsx)(n.code,{children:"moon ci"})}),"), and all actions (tasks)\nthat have ran based on affected files. In the future these insights will help catch regressions,\nalert on flakiness, provide granular metrics, and help monitor the health of your CI pipeline and\nrepositories."]}),"\n",(0,o.jsx)(i.Z,{src:t(17032),width:"90%"}),"\n",(0,o.jsx)(n.p,{children:"With this initial release, we track touched files, which targets are affected based on those files,\nan estimation on how much time was saved or lost, the actions that ran and their final status,\noutlined as a timeline."}),"\n",(0,o.jsx)(i.Z,{src:t(15756),width:"90%"}),"\n",(0,o.jsxs)(n.p,{children:["Insights are enabled by default if you're using moonbase in your CI pipeline, and start using moon\nv0.25! You can disable insights gathering from your\n",(0,o.jsx)(n.a,{href:"https://moonrepo.app",children:"organization settings page"}),"."]}),"\n",(0,o.jsx)(n.h2,{id:"offline-mode",children:"Offline mode"}),"\n",(0,o.jsx)(n.p,{children:"moon assumes that an internet connection is always available, as we download and install tools into\nthe toolchain, resolve versions against upstream manifests, and automatically install dependencies.\nWhile this is useful, having a constant internet connection isn't always viable."}),"\n",(0,o.jsxs)(n.p,{children:["In this release, we now check for an active internet connection and bypass certain workflows when\napplicable.\n",(0,o.jsx)(n.a,{href:"/docs/guides/offline-mode",children:"Jump to the official guide on offline mode for more information"}),"!"]}),"\n",(0,o.jsxs)(n.h2,{id:"custom-project-language",children:["Custom project ",(0,o.jsx)(n.code,{children:"language"})]}),"\n",(0,o.jsxs)(n.p,{children:["Project's have always been able to define a ",(0,o.jsx)(n.a,{href:"/docs/config/project#language",children:(0,o.jsx)(n.code,{children:"language"})})," in\n",(0,o.jsx)(n.a,{href:"/docs/config/project",children:(0,o.jsx)(n.code,{children:"moon.yml"})})," that denotes the primary programming language for the project.\nHistorically this has been a strict enum of supported values, and could ",(0,o.jsx)(n.em,{children:"not"})," be customized for\nother languages. With the introduction of\n",(0,o.jsx)(n.a,{href:"./v0.23#new-scoped-tasks-with-moontasksyml",children:"language driven task inheritance"}),", we felt like\nrevisiting this setting, and as such, you're now able to define ",(0,o.jsx)(n.em,{children:"any"})," language in this setting,\nwhich also feeds into the task inheritance system."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",metastring:'title="moon.yml"',children:"language: 'kotlin'\n"})}),"\n",(0,o.jsxs)(n.p,{children:["With this change, ",(0,o.jsx)(n.code,{children:".moon/tasks/kotlin-application.yml"}),", ",(0,o.jsx)(n.code,{children:".moon/tasks/dotnet.yml"}),", and other\nvariations are now possible! However, besides task inheritance, other functionality like platform\ndetection, and Dockerfile support are not enabled."]}),"\n",(0,o.jsx)(n.h2,{id:"project-level-typescript-settings-breaking",children:"Project-level TypeScript settings (breaking)"}),"\n",(0,o.jsxs)(n.p,{children:["Our TypeScript integration supports many automated workflows, like syncing project references, and\nrouting ",(0,o.jsx)(n.code,{children:"outDir"})," to our shared cache. This is wonderful for the majority, but for the handful of\nprojects where these settings were not viable, there was no simple way to disable or opt out of the\nfunctionality."]}),"\n",(0,o.jsxs)(n.p,{children:["Well no more, projects can now override the workspace-level TypeScript settings\n",(0,o.jsx)(n.code,{children:"routeOutDirToCache"}),", ",(0,o.jsx)(n.code,{children:"syncProjectReferences"}),", and ",(0,o.jsx)(n.code,{children:"syncProjectReferencesToPaths"})," through the\n",(0,o.jsx)(n.a,{href:"/docs/config/project#typescript",children:(0,o.jsx)(n.code,{children:"toolchain.typescript"})})," setting in\n",(0,o.jsx)(n.a,{href:"/docs/config/project",children:(0,o.jsx)(n.code,{children:"moon.yml"})}),"."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",metastring:'title="moon.yml"',children:"toolchain:\n  typescript:\n    routeOutDirToCache: false\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Because this setting was changed from a boolean to an object, the old pattern of disabling\nTypescript must now use the ",(0,o.jsx)(n.code,{children:"disabled"})," setting."]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",metastring:'title="moon.yml"',children:"# Old\ntoolchain:\n  typescript: false\n\n# new\ntoolchain:\n  typescript:\n    disabled: true\n"})}),"\n",(0,o.jsxs)(n.h2,{id:"new-moonreposetup-moon-action-github-action",children:["New ",(0,o.jsx)(n.code,{children:"moonrepo/setup-moon-action"})," GitHub action"]}),"\n",(0,o.jsxs)(n.p,{children:["If you're using GitHub Actions as your CI pipeline, we've introducing a new action called\n",(0,o.jsx)(n.a,{href:"https://github.com/moonrepo/setup-moon-action",children:"moonrepo/setup-moon-action"}),", that will install the\n",(0,o.jsx)(n.code,{children:"moon"})," binary globally, and will cache (and restore) the moon toolchain."]}),"\n",(0,o.jsx)(n.p,{children:"With this new action, let moon handle all the heavy lifting, and avoid all the unnecessary steps\naround setting up Node.js, and install dependencies."}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"jobs:\n  ci:\n    name: 'CI'\n    runs-on: 'ubuntu-latest'\n    steps:\n      - uses: actions/checkout@v4\n        with:\n          fetch-depth: 0\n      - uses: moonrepo/setup-moon-action@v1\n      - run: moon ci\n"})}),"\n",(0,o.jsx)(n.h2,{id:"other-changes",children:"Other changes"}),"\n",(0,o.jsxs)(n.p,{children:["View the\n",(0,o.jsx)(n.a,{href:"https://github.com/moonrepo/moon/releases/tag/%40moonrepo%2Fcli%400.25.0",children:"official release"})," for a\nfull list of changes."]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Updated project, task, and target identifiers to support periods (",(0,o.jsx)(n.code,{children:"."}),")."]}),"\n",(0,o.jsx)(n.li,{children:"Refactored glob matching to use workspace relative paths instead of absolute. Please report an\nissue if hashing or affected detection is now inaccurate."}),"\n",(0,o.jsx)(n.li,{children:"We now build against older operating systems in an attempt to solve GLIBC version errors."}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"whats-next",children:"What's next?"}),"\n",(0,o.jsx)(n.p,{children:"Expect the following in the v0.26 release!"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Officially release proto!"}),"\n",(0,o.jsx)(n.li,{children:"Improved Deno interoperability."}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,a.a)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(u,{...e})}):u(e)}},39798:(e,n,t)=>{t.d(n,{Z:()=>s});t(27378);var o=t(40624);const a={tabItem:"tabItem_wHwb"};var i=t(24246);function s(e){let{children:n,hidden:t,className:s}=e;return(0,i.jsx)("div",{role:"tabpanel",className:(0,o.Z)(a.tabItem,s),hidden:t,children:n})}},33337:(e,n,t)=>{t.d(n,{Z:()=>p});var o=t(27378),a=t(40624),i=t(83457),s=t(35595),r=t(76457);const l={tabList:"tabList_J5MA",tabItem:"tabItem_l0OV"};var c=t(24246);function d(e){let{className:n,block:t,selectedValue:o,selectValue:s,tabValues:r}=e;const d=[],{blockElementScrollPositionUntilNextRender:u}=(0,i.o5)(),h=e=>{const n=e.currentTarget,t=d.indexOf(n),a=r[t].value;a!==o&&(u(n),s(a))},p=e=>{let n=null;switch(e.key){case"Enter":h(e);break;case"ArrowRight":{const t=d.indexOf(e.currentTarget)+1;n=d[t]??d[0];break}case"ArrowLeft":{const t=d.indexOf(e.currentTarget)-1;n=d[t]??d[d.length-1];break}}n?.focus()};return(0,c.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,a.Z)("tabs",{"tabs--block":t},n),children:r.map((e=>{let{value:n,label:t,attributes:i}=e;return(0,c.jsx)("li",{role:"tab",tabIndex:o===n?0:-1,"aria-selected":o===n,ref:e=>d.push(e),onKeyDown:p,onClick:h,...i,className:(0,a.Z)("tabs__item",l.tabItem,i?.className,{"tabs__item--active":o===n}),children:t??n},n)}))})}function u(e){let{lazy:n,children:t,selectedValue:a}=e;const i=(Array.isArray(t)?t:[t]).filter(Boolean);if(n){const e=i.find((e=>e.props.value===a));return e?(0,o.cloneElement)(e,{className:"margin-top--md"}):null}return(0,c.jsx)("div",{className:"margin-top--md",children:i.map(((e,n)=>(0,o.cloneElement)(e,{key:n,hidden:e.props.value!==a})))})}function h(e){const n=(0,s.Y)(e);return(0,c.jsxs)("div",{className:(0,a.Z)("tabs-container",l.tabList),children:[(0,c.jsx)(d,{...n,...e}),(0,c.jsx)(u,{...n,...e})]})}function p(e){const n=(0,r.Z)();return(0,c.jsx)(h,{...e,children:(0,s.h)(e.children)},String(n))}},35595:(e,n,t)=>{t.d(n,{Y:()=>p,h:()=>c});var o=t(27378),a=t(3620),i=t(9834),s=t(30654),r=t(70784),l=t(55643);function c(e){return o.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,o.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function d(e){const{values:n,children:t}=e;return(0,o.useMemo)((()=>{const e=n??function(e){return c(e).map((e=>{let{props:{value:n,label:t,attributes:o,default:a}}=e;return{value:n,label:t,attributes:o,default:a}}))}(t);return function(e){const n=(0,r.l)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,t])}function u(e){let{value:n,tabValues:t}=e;return t.some((e=>e.value===n))}function h(e){let{queryString:n=!1,groupId:t}=e;const i=(0,a.k6)(),r=function(e){let{queryString:n=!1,groupId:t}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:n,groupId:t});return[(0,s._X)(r),(0,o.useCallback)((e=>{if(!r)return;const n=new URLSearchParams(i.location.search);n.set(r,e),i.replace({...i.location,search:n.toString()})}),[r,i])]}function p(e){const{defaultValue:n,queryString:t=!1,groupId:a}=e,s=d(e),[r,c]=(0,o.useState)((()=>function(e){let{defaultValue:n,tabValues:t}=e;if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!u({value:n,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${t.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const o=t.find((e=>e.default))??t[0];if(!o)throw new Error("Unexpected error: 0 tabValues");return o.value}({defaultValue:n,tabValues:s}))),[p,m]=h({queryString:t,groupId:a}),[g,f]=function(e){let{groupId:n}=e;const t=function(e){return e?`docusaurus.tab.${e}`:null}(n),[a,i]=(0,l.Nk)(t);return[a,(0,o.useCallback)((e=>{t&&i.set(e)}),[t,i])]}({groupId:a}),b=(()=>{const e=p??g;return u({value:e,tabValues:s})?e:null})();(0,i.Z)((()=>{b&&c(b)}),[b]);return{selectedValue:r,selectValue:(0,o.useCallback)((e=>{if(!u({value:e,tabValues:s}))throw new Error(`Can't select invalid tab value=${e}`);c(e),m(e),f(e)}),[m,f,s]),tabValues:s}}},88109:(e,n,t)=>{t.d(n,{Z:()=>a});var o=t(24246);function a(e){let{src:n,width:t="90%",alt:a="",title:i,align:s="center",padding:r="1rem"}=e;return(0,o.jsx)("div",{style:{marginBottom:r,marginTop:r,textAlign:s},children:(0,o.jsx)("img",{src:n.default,width:t,alt:a,title:i,className:"inline-block"})})}},6995:(e,n,t)=>{t.d(n,{Z:()=>o});const o=t.p+"assets/images/v0.25-a7107e8421326425d72769c0742873ac.png"},15756:(e,n,t)=>{t.r(n),t.d(n,{default:()=>o});const o=t.p+"assets/images/run-detail-37622c4b8e3faaefb1fc8b43ce794036.png"},17032:(e,n,t)=>{t.r(n),t.d(n,{default:()=>o});const o=t.p+"assets/images/runs-list-eb2d2c47d5a970e36bfe0b53892ad20c.png"},71670:(e,n,t)=>{t.d(n,{Z:()=>r,a:()=>s});var o=t(27378);const a={},i=o.createContext(a);function s(e){const n=o.useContext(i);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),o.createElement(i.Provider,{value:n},e.children)}}}]);